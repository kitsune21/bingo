<div>
  <nav class="flex pl-4 gap-2">
    <%= link_to "Back", root_path, class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
    <%= link_to "Delete Game", bingo_game_path(@bingo_game), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this game?" }, class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
    <%= link_to "Edit Game", generate_squares_bingo_game_path(@bingo_game), class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
  </nav>

  <div 
    data-controller="squares" 
    data-squares-bingo-game-id-value="<%= @bingo_game.id %>" 
    id="bingo-game-detail-container"
  >
    <div data-controller="bingo-games" id="bingo-games-container">
      <h1 class="text-4xl font-extrabold text-center text-gray-900 pb-8" id="title">
        <%= @bingo_game.name %>
      </h1>

      <div class="flex justify-center"><span data-squares-target="percentageCompleted"><%= @bingo_game.percentage_completed %></span>% Completed</div>
  <div class="grid grid-cols-5 w-full max-w-xl mx-auto p-4 bg-gray-100 rounded-lg shadow-lg">
  <%
    bingo_orderings = @bingo_game.check_for_bingo!
  %>
  <% 25.times do |i| %>
  <%
    square = @bingo_game.squares.find_by(ordering: i)
    content = square&.content || ''
    square_id = square&.id
    is_free_space = (i == 12)
    completed_display_state = (square&.completed || false) || is_free_space
    quantity = square&.quantity
    quantity_completed = square&.quantity_completed || 0
    bingod_square = bingo_orderings && bingo_orderings.include?(square&.ordering)
  %>
  <div class="group overflow-x-hidden overflow-y-auto aspect-square flex items-center justify-center bg-white border border-gray-300 rounded text-xl font-bold relative">
    <% if !is_free_space %>
      <button
        class="resize-none h-full w-full text-center p-2 focus:outline-none transition-all duration-200 ease-in-out
          <% if bingod_square %>
            bingod-square
          <% elsif completed_display_state %>
            completed-square
          <% end %>"
        data-square-id="<%= square_id %>"
        data-square-ordering="<%= i %>"
        data-action="click->squares#updateCompleted"
        data-completed="<%= completed_display_state %>"
        data-quantity-completed="<%= quantity_completed %>"
        data-quantity="<%= quantity %>"
      ><%= content %></button>
      <% if quantity && quantity > 0 %>
        <div
          class="group-hover:left-0.5 absolute bottom-0.5 -left-20 justify-center z-10 border border-slate-500 rounded-lg bg-white transition-all duration-150 ease-in-out"
        >
	        <p class="quantity-display"><%= quantity_completed %>/<%= quantity %></p>
        </div>
      <% end %>
    <% else %>
      <p class="resize-none h-full w-full flex items-center justify-center p-2 bingod-square">Free</p>
    <% end %>
  </div>
  <% end %>
</div>